<% if @user == current_user %>
  <ul class="nav nav-tabs" role="tablist">
    <li class="active"><%= link_to 'View list', user_runs_path(@user) %></li>
    <li><%= link_to new_user_run_path(@user) do %>
      <i class="glyphicon glyphicon-plus"></i> New Run
    <% end %></li>
  </ul>
<% end %>

<br>
<ul class="list-inline">
  <li>
    <strong>Total Distance to date: </strong>
    <%= @runs.sum(:distance).round(2) %>
  </li>
  <li>
    <strong>Total Distance this month: </strong>
    <%= month_runs = @runs.where(
          occurred_at: Time.zone.now.beginning_of_month..Time.zone.now.end_of_month
        )
        month_runs.sum(:distance).round(2) %>
  </li>
  <li>
    <strong>Total Distance this week: </strong>
    <%= week_runs = @runs.where(
          occurred_at: Time.zone.now.beginning_of_week..Time.zone.now.end_of_week
        )
        week_runs.sum(:distance).round(2) %>
  </li>
</ul>

<% if @user == current_user %>
  <h1>Your Runs</h1>
<% else %>
  <h1><%= "#{@user.first_name.capitalize}'s Runs" %></h1>
<% end %>

<table class="table table-condensed table-hover">
  <thead>
    <tr>
      <th>Occurred at</th>
      <th>Distance (miles)</th>
      <th>Duration</th>
      <th>Pace (min/mile)</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @runs.each do |run| %>
      <tr>
        <td><%= run.occurred_at.localtime.strftime("%b %d, %Y at %l:%M %P") %></td>
        <td><%= run.distance.round(2) %></td>
        <td><%= seconds = run.duration % 60
                minutes = (run.duration / 60) % 60
                hours = run.duration / (60 * 60)
                format("%02d:%02d:%02d", hours, minutes, seconds) %></td>
        <td><%= duration_per_mile = (run.duration / run.distance)
                seconds = duration_per_mile % 60
                minutes = (duration_per_mile / 60) % 60
                hours = duration_per_mile / (60 * 60)
                format("%02d:%02d:%02d", hours, minutes, seconds) %>
        <td>
          <div class="btn btn-default"><%= link_to 'Show', [run.user, run] %></div>
        </td>
        <td>
          <% if current_user == run.user %>
            <div class="btn btn-warning"><%= link_to 'Edit', edit_user_run_path(run.user, run) %></div>
          <% end %>
        </td>
        <td>
          <% if current_user == run.user %>
            <div class="btn btn-danger"><%= link_to 'Destroy', [run.user, run], method: :delete, data: { confirm: 'Are you sure?' } %></div>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
